<!-- このセクション全体を囲むコンテナを追加 -->
<div id="tcg-battlerecord-section">
    <h2 class="section-title">戦いの記録</h2>
    <p>対戦記録、デッキ管理、そして試合のリプレイ・観戦機能を利用できます。</p>

    <div class="battle-record-tabs">
        <button class="battle-record-tab-button" data-tab="new-record"><i class="fas fa-plus-circle"></i> 新規記録</button>
        <button class="battle-record-tab-button" data-tab="deck-management"><i class="fas fa-layer-group"></i> デッキ管理</button>
        <button class="battle-record-tab-button" data-tab="stats-summary"><i class="fas fa-chart-bar"></i> 集計結果</button>
        <button class="battle-record-tab-button" data-tab="past-records"><i class="fas fa-history"></i> 過去の記録</button>
        <button class="battle-record-tab-button" data-tab="replay"><i class="fas fa-video"></i> リプレイ</button>
        <button class="battle-record-tab-button" data-tab="spectate"><i class="fas fa-tv"></i> 観戦</button>
    </div>

    <!-- 観戦機能タブ -->
    <div id="battle-record-tab-spectate" class="battle-record-tab-content">
        <h3><i class="fas fa-tv"></i> 観戦モード (調整中)</h3>
        <div class="spectate-section">
            <!-- 配信側UI -->
            <div class="spectate-box">
                <h4><i class="fas fa-satellite-dish"></i> 自分のゲームを配信する</h4>
                <p>現在のゲーム画面を他の人が観戦できるように配信します。</p>
                <button id="start-broadcast-button" class="button-style"><i class="fas fa-play-circle"></i> 配信を開始</button>
                <button id="stop-broadcast-button" class="button-style" style="display: none;"><i class="fas fa-stop-circle"></i> 配信を停止</button>
                <div id="broadcast-status" style="display: none;">
                    <p>配信中です。ルームID: <strong id="broadcast-room-id-display"></strong></p>
                </div>
            </div>
            <!-- 視聴側UI -->
            <div class="spectate-box">
                <h4><i class="fas fa-binoculars"></i> 他人のゲームを観戦する</h4>
                <div id="broadcast-list-wrapper">
                    <div class="broadcast-list-header">
                        <h5><i class="fas fa-list-alt"></i> 配信中リスト</h5>
                        <button id="refresh-broadcast-list-button" class="button-style" title="リストを更新"><i class="fas fa-sync-alt"></i></button>
                    </div>
                    <ul id="broadcast-list">
                        <li>現在、配信中のルームはありません。</li>
                    </ul>
                </div>
                <div id="spectate-view" style="display: none;">
                    <video id="spectate-video" autoplay playsinline></video>
                    <button id="stop-spectate-button" class="button-style"><i class="fas fa-sign-out-alt"></i> 観戦を終了</button>
                </div>
            </div>
        </div>
    </div>


    <!-- リプレイ機能タブ -->
    <div id="battle-record-tab-replay" class="battle-record-tab-content active">
        <h3><i class="fas fa-video"></i> リプレイ機能</h3>
        <div class="replay-section">
            <div id="replay-controls">
                <p>現在のタブ（ゲーム画面）を録画して、後から見返すことができます。</p>
                <button id="start-replay-record-button" class="button-style"><i class="fas fa-record-vinyl"></i> 録画開始</button>
                <button id="stop-replay-record-button" class="button-style" style="display: none;"><i class="fas fa-stop-circle"></i> 録画停止</button>
                <p id="record-status" class="record-status-idle">ステータス: 待機中</p>
            </div>

            <div id="replay-player-wrapper" style="display: none;">
                <h4>リプレイ再生</h4>
                <video id="replay-video" controls></video>
                <button id="close-replay-player-button" class="button-style">プレイヤーを閉じる</button>
            </div>

            <div id="replay-list-wrapper">
                <h4><i class="fas fa-list-ul"></i> 保存されたリプレイ</h4>
                <ul id="replays-list">
                    <li>リプレイはありません。</li>
                </ul>
            </div>
        </div>
    </div>


    <div id="battle-record-tab-new-record" class="battle-record-tab-content">
        <h3><i class="fas fa-plus-circle"></i> 新しい対戦記録</h3>
        <div class="battle-record-form">
            <label for="my-deck-select">自分のデッキ名:</label>
            <select id="my-deck-select">
                <option value="">登録済みデッキから選択</option>
            </select>

            <label for="opponent-deck-select">相手のデッキ名:</label>
            <select id="opponent-deck-select">
                <option value="">登録済みデッキから選択</option>
            </select>

            <label for="win-loss-select">勝敗:</label>
            <select id="win-loss-select">
                <option value="win">勝利</option>
                <option value="lose">敗北</option>
            </select>

            <label for="first-second-select">先攻/後攻:</label>
            <select id="first-second-select">
                <option value="">選択してください</option>
                <option value="first">先攻</option>
                <option value="second">後攻</option>
            </select>

            <label for="notes-textarea">特記事項 (任意):</label>
            <textarea id="notes-textarea" placeholder="メモや反省点など" rows="3"></textarea>

            <button id="save-battle-record-button" class="button-style"><i class="fas fa-save"></i> 記録を保存</button>
        </div>
    </div>

    <div id="battle-record-tab-deck-management" class="battle-record-tab-content">
        <h3><i class="fas fa-layer-group"></i> デッキ管理</h3>
        <div class="deck-management-section">
            <div class="deck-register-form">
                <label for="new-deck-name">デッキ名:</label>
                <input type="text" id="new-deck-name" placeholder="新しいデッキ名">
                <label for="new-deck-type">デッキタイプ:</label>
                <select id="new-deck-type">
                    <option value="">選択してください</option>
                    <option value="アグロ">アグロ</option>
                    <option value="コントロール">コントロール</option>
                    <option value="ミッドレンジ">ミッドレンジ</option>
                    <option value="コンボ">コンボ</option>
                    <option value="その他">その他</option>
                </select>
                <button id="register-deck-button" class="button-style"><i class="fas fa-plus"></i> デッキを登録</button>
            </div>
            <h4>登録済みデッキリスト</h4>
            <ul id="registered-decks-list">
                <li>まだ登録されたデッキがありません。</li>
            </ul>
        </div>
    </div>

    <div id="battle-record-tab-stats-summary" class="battle-record-tab-content">
        <h3><i class="fas fa-chart-bar"></i> 集計結果</h3>
        <div id="battle-stats">
            <p>総対戦数: <span id="total-games">0</span></p>
            <p>勝利数: <span id="total-wins">0</span></p>
            <p>敗北数: <span id="total-losses">0</span></p>
            <p>勝率: <span id="win-rate">0.00%</span></p>
            <p>先攻勝率: <span id="first-win-rate">0.00%</span></p>
            <p>後攻勝率: <span id="second-win-rate">0.00%</span></p>

            <h4>自分のデッキタイプ別勝率</h4>
            <div id="my-deck-type-win-rates">
                <!-- 自分のデッキタイプ別勝率がここに表示されます -->
            </div>
            <h4>相手のデッキタイプ別勝率</h4>
            <div id="opponent-deck-type-win-rates">
                <!-- 相手のデッキタイプ別勝率がここに表示されます -->
            </div>
            
            <h4><i class="fas fa-dice-d20"></i> デッキ別詳細分析</h4>
            <label for="selected-deck-for-stats">デッキを選択:</label>
            <select id="selected-deck-for-stats">
                <option value="">全てのデッキ</option>
            </select>
            <div id="selected-deck-stats-detail">
                <!-- 選択されたデッキの詳細な勝率がここに表示されます -->
            </div>
        </div>
    </div>

    <div id="battle-record-tab-past-records" class="battle-record-tab-content">
        <h3><i class="fas fa-history"></i> 過去の対戦記録リスト</h3>
        <ul id="battle-records-list">
            <li>まだ対戦記録がありません。</li>
        </ul>
    </div>
</div>
