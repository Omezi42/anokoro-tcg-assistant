<h2 class="section-title">レート戦</h2>
<div class="rate-match-info">
    <div class="info-box">
        <h3>現在のレート</h3>
        <p id="rate-display">1500</p>
    </div>
    <div class="info-box">
        <h3>あなたの表示名</h3>
        <p id="display-name-display">未ログイン</p>
    </div>
</div>

<!-- アカウント認証セクション -->
<div id="auth-section">
    <h3>アカウント登録 / ログイン</h3>
    <div class="auth-form">
        <h4>アカウント登録</h4>
        <input type="text" id="register-username" placeholder="ユーザー名" required autocomplete="username">
        <input type="password" id="register-password" placeholder="パスワード" required autocomplete="new-password">
        <button id="register-button">登録</button>
    </div>
    <div class="auth-form">
        <h4>ログイン</h4>
        <input type="text" id="login-username" placeholder="ユーザー名" required autocomplete="username">
        <input type="password" id="login-password" placeholder="パスワード" required autocomplete="current-password">
        <button id="login-button">ログイン</button>
    </div>
</div>

<!-- ログイン後のUI要素 -->
<!-- ★修正点: UIの状態をクラスで管理するように変更 -->
<div id="logged-in-ui" style="display: none;" class="state-pre-match">
    <!-- 表示名変更UI -->
    <div class="display-name-section auth-form">
        <h4>表示名の変更</h4>
        <input type="text" id="new-display-name-input" placeholder="新しい表示名" required>
        <button id="update-display-name-button">表示名を更新</button>
    </div>
    <button id="logout-button">ログアウト</button>

    <!-- マッチング前のUI要素 -->
    <div class="ui-state-container" id="pre-match-ui">
        <button id="matching-button">オンラインマッチング</button>
        <h3>対戦履歴</h3>
        <ul id="match-history-list">
            <li>ログインすると対戦履歴が表示されます。</li>
        </ul>
        
        <div id="ranking-display">
            <h3><i class="fas fa-trophy"></i> トッププレイヤーランキング</h3>
            <button id="refresh-ranking-button" class="action-button small-button"><i class="fas fa-sync-alt"></i> 更新</button>
            <ol id="ranking-list">
                <li>ランキングを読み込み中...</li>
            </ol>
        </div>
    </div>

    <!-- マッチング中の表示 -->
    <div class="ui-state-container" id="matching-status" data-is-matching="false">
        <p><span id="matching-status-text">対戦相手を検索中...</span></p>
        <div class="spinner"></div>
        <button id="cancel-matching-button-in-status" class="cancel-button"><i class="fas fa-times-circle"></i> マッチングキャンセル</button>
    </div>

    <!-- 対戦中（マッチング後）のUI要素 -->
    <div class="ui-state-container" id="post-match-ui">
        <h4>対戦相手情報</h4>
        <div class="info-box opponent-info-box">
            <p>相手プレイヤー: <span id="opponent-username-display"></span></p>
            <p>接続状態: <span id="webrtc-connection-status">接続中...</span></p>
        </div>

        <h4>チャット</h4>
        <div id="chat-messages"></div>
        <div class="chat-fixed-phrases">
            <button class="chat-phrase-button">よろしくお願いします！</button>
            <button class="chat-phrase-button">ナイスゲームでした！</button>
            <button class="chat-phrase-button">GG</button>
            <button class="chat-phrase-button">対戦ありがとうございました！</button>
        </div>
        <div class="chat-input-wrapper">
            <input type="text" id="chat-input" placeholder="メッセージを入力..." disabled>
            <button id="send-chat-button" disabled>送信</button>
        </div>
        <h4>対戦結果報告</h4>
        <div class="rate-match-actions">
            <button id="win-button" class="win" data-result="win"><i class="fas fa-check-circle"></i> 勝利</button>
            <button id="lose-button" class="lose" data-result="lose"><i class="fas fa-times-circle"></i> 敗北</button>
            <button id="cancel-button" data-result="cancel"><i class="fas fa-stop-circle"></i> 対戦中止</button>
        </div>
    </div>
</div>
